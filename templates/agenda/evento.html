{% extends "base/layout.html" %}
{% load static %}

{% block title %}{% if evento.id %}Editar Evento{% else %}Novo Evento{% endif %} - Synchro{% endblock %}
{% block page_title %}{% if evento.id %}Editar Evento{% else %}Novo Evento{% endif %}{% endblock %}
{% block page_subtitle %}{% if evento.id %}Atualize as informa√ß√µes do seu evento{% else %}Preencha os detalhes do seu novo evento{% endif %}{% endblock %}

{% block content %}

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i data-feather="calendar"></i>
                Informa√ß√µes do Evento
            </h3>
        </div>
        <div class="card-body">
            <form action="{% url 'agenda:submit_evento' %}" method="POST" id="evento-form"> {% csrf_token %}
                <input type="number" name="id_evento" value="{{ evento.id }}" hidden>
                
                <div style="display: grid; gap: 1.5rem;">
                    <!-- T√≠tulo do Evento -->
                    <div class="form-group">
                        <label for="titulo" class="form-label">
                            <i data-feather="type"></i>
                            T√≠tulo do Evento *
                        </label>
                        <input type="text" id="titulo" name="titulo" class="form-input" 
                               value="{{ evento.titulo }}" placeholder="Ex: Reuni√£o de equipe" required>
                    </div>

                    <!-- Data/Hora e Categoria -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="dt_evento" class="form-label">
                                <i data-feather="clock"></i>
                                Data e Hora *
                            </label>
                            <input type="datetime-local" id="dt_evento" name="dt_evento" 
                                   class="form-input" value="{{ evento.get_data_input_evento }}" required>
                        </div>

                        <div class="form-group">
                            <label for="categoria" class="form-label">
                                <i data-feather="tag"></i>
                                Categoria
                            </label>
                            <select id="categoria" name="categoria" class="form-select">
                                <option value="">Selecione uma categoria</option>
                                {% for cat in categorias %}
                                    <option value="{{ cat.id }}" {% if evento.categoria_id == cat.id %}selected{% endif %}>
                                        {{ cat.nome }}
                                    </option>
                                {% endfor %}
                            </select>
                            {% if categorias.count == 0 %}
                                <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                    <a href="{% url 'agenda:categorias' %}" style="color: var(--primary-color);">
                                        Crie sua primeira categoria aqui
                                    </a>
                                </p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Local e Prioridade -->
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 1rem;">
                        <div class="form-group">
                            <label for="local" class="form-label">
                                <i data-feather="map-pin"></i>
                                Local
                            </label>
                            <input type="text" id="local" name="local" class="form-input" 
                                   value="{{ evento.local }}" placeholder="Ex: Sala de reuni√µes, Online">
                        </div>

                        <div class="form-group">
                            <label for="prioridade" class="form-label">
                                <i data-feather="flag"></i>
                                Prioridade
                            </label>
                            <select id="prioridade" name="prioridade" class="form-select">
                                <option value="baixa" {% if evento.prioridade == 'baixa' %}selected{% endif %}>Baixa</option>
                                <option value="media" {% if evento.prioridade == 'media' %}selected{% endif %}>M√©dia</option>
                                <option value="alta" {% if evento.prioridade == 'alta' %}selected{% endif %}>Alta</option>
                            </select>
                        </div>
                    </div>

                    <!-- Descri√ß√£o -->
                    <div class="form-group">
                        <label for="descricao" class="form-label">
                            <i data-feather="file-text"></i>
                            Descri√ß√£o
                        </label>
                        <textarea id="descricao" name="descricao" class="form-textarea" rows="4"
                                  placeholder="Adicione detalhes sobre o evento, agenda, participantes, etc.">{{ evento.descricao }}</textarea>
                    </div>

                    <!-- Op√ß√µes Adicionais -->
                    <div class="form-group">
                        <label class="form-label">
                            <i data-feather="settings"></i>
                            Op√ß√µes
                        </label>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="checkbox" name="evento_dia_todo" {% if evento.evento_dia_todo %}checked{% endif %}>
                                <span>Evento de dia inteiro</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="checkbox" name="privado" {% if evento.privado %}checked{% endif %}>
                                <span>Evento privado</span>
                            </label>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="card-footer">
            <div style="display: flex; gap: 1rem; justify-content: space-between; align-items: center;">
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" form="evento-form" class="btn btn-primary">
                        <i data-feather="save"></i>
                        {% if evento.id %}Atualizar Evento{% else %}Criar Evento{% endif %}
                    </button>
                    <a href="{% url 'agenda:lista' %}" class="btn btn-secondary">
                        <i data-feather="arrow-left"></i>
                        Voltar √† Lista
                    </a>
                </div>
                {% if evento.id %}
                    <a href="{% url 'agenda:delete_evento' evento.id %}" 
                       class="btn btn-danger btn-sm"
                       onclick="return confirm('Tem certeza que deseja excluir este evento?')">
                        <i data-feather="trash-2"></i>
                        Excluir
                    </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Card de Ajuda -->
    <div class="card" style="margin-top: 1.5rem;">
        <div class="card-body">
            <h4 style="margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
                <i data-feather="help-circle"></i>
                Dicas para criar um bom evento
            </h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; font-size: 0.875rem; color: var(--text-secondary);">
                <div>
                    <strong>üìù T√≠tulo:</strong> Use t√≠tulos claros e espec√≠ficos como "Reuni√£o de planejamento Q1"
                </div>
                <div>
                    <strong>üè∑Ô∏è Categoria:</strong> Organize eventos por categoria para facilitar filtros
                </div>
                <div>
                    <strong>üìç Local:</strong> Seja espec√≠fico: "Sala 201" ou "Google Meet - link nos detalhes"
                </div>
                <div>
                    <strong>‚ö° Prioridade:</strong> Use para destacar eventos importantes na sua agenda
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Melhorar UX do checkbox de dia inteiro
        const diaInteiroCheckbox = document.querySelector('input[name="evento_dia_todo"]');
        const dataHoraInput = document.querySelector('#dt_evento');
        
        if (diaInteiroCheckbox && dataHoraInput) {
            diaInteiroCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    // Se for dia inteiro, definir hor√°rio como 00:00
                    const currentDate = dataHoraInput.value.split('T')[0];
                    if (currentDate) {
                        dataHoraInput.value = currentDate + 'T00:00';
                    }
                }
            });
        }

        // Auto-focus no t√≠tulo quando a p√°gina carregar
        const tituloInput = document.querySelector('#titulo');
        if (tituloInput && !tituloInput.value) {
            tituloInput.focus();
        }

        // Valida√ß√£o de data no passado
        dataHoraInput.addEventListener('change', function() {
            const selectedDate = new Date(this.value);
            const now = new Date();
            
            if (selectedDate < now) {
                const confirmPast = confirm('Voc√™ selecionou uma data no passado. Deseja continuar?');
                if (!confirmPast) {
                    this.value = '';
                }
            }
        });
    });
</script>
{% endblock %}